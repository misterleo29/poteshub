<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PotesHub — v2</title>
  <link rel="stylesheet" href="style.css?v=5">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1a1a1a" />
</head>
<body>
  <!-- AUTH / ENTRY -->
  <div id="authPage" class="auth-container">
    <div class="container">
      <div class="auth-box">
        <h1 class="auth-title"><span class="icon">🎮</span> PotesHub</h1>
        <p class="auth-subtitle">App entre potes — connecte-toi</p>

        <div id="errorMsg" class="error-message"></div>
        <div id="successMsg" class="success-message"></div>

        <div id="loginForm">
          <div class="input-group">
            <label for="loginEmail">Email</label>
            <input id="loginEmail" type="email" placeholder="ton@email.com"/>
          </div>
          <div class="input-group">
            <label for="loginPassword">Mot de passe</label>
            <input id="loginPassword" type="password" placeholder="••••••••"/>
          </div>
          <div class="checkbox-group">
            <input id="rememberMe" type="checkbox"/><label for="rememberMe">Rester connecté</label>
          </div>
          <button id="loginBtn" class="btn btn-primary">Se connecter</button>
          <button id="showRegisterBtn" class="btn btn-secondary">Créer un compte</button>
        </div>

        <div id="registerForm" class="hidden">
          <div class="input-group">
            <label for="registerUsername">Pseudo</label>
            <input id="registerUsername" type="text" placeholder="TonPseudo"/>
          </div>
          <div class="input-group">
            <label for="registerEmail">Email</label>
            <input id="registerEmail" type="email" placeholder="ton@email.com"/>
          </div>
          <div class="input-group">
            <label for="registerPassword">Mot de passe</label>
            <input id="registerPassword" type="password" placeholder="••••••••"/>
          </div>
          <button id="registerBtn" class="btn btn-primary">Créer mon compte</button>
          <button id="showLoginBtn" class="btn btn-secondary">J'ai déjà un compte</button>
        </div>
      </div>
    </div>
  </div>

  <!-- APP MAIN -->
  <div id="mainApp" class="hidden">
    <div class="container" style="margin-bottom:110px;">
      <div class="header">
        <div class="user-info">
          <div id="userAvatar" class="user-avatar">U</div>
          <div>
            <div id="userName" style="font-weight:700">Utilisateur</div>
            <div id="userMood" style="font-size:12px;color:rgba(255,255,255,0.6)">—</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <select id="roomSelect" style="padding:8px;border-radius:10px;">
            <!-- rooms populated dynamically -->
          </select>
          <button id="openProfileBtn" class="btn btn-secondary" style="padding:8px 10px;">Profil</button>
          <button id="openAdminBtn" class="btn btn-secondary" style="display:none;padding:8px 10px;">Admin</button>
          <button id="logoutBtn" class="logout-btn">Déconnexion</button>
        </div>
      </div>

      <div id="controls" style="margin-bottom:12px;">
        <div class="action-buttons">
          <div class="action-btn" id="btnQuickPlay"><div class="icon">🎮</div><div class="label">Qui joue ?</div></div>
          <div class="action-btn" id="btnHelp"><div class="icon">🆘</div><div class="label">Aide</div></div>
          <div class="action-btn" id="btnPoll"><div class="icon">🗳️</div><div class="label">Créer sondage</div></div>
          <div class="action-btn" id="btnChallenge"><div class="icon">🔥</div><div class="label">Défi</div></div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px;">
          <button id="openRecorderBtn" class="btn btn-secondary">🎤 Enregistrer voix</button>
          <button id="openDictBtn" class="btn btn-secondary">🎙️ Dicter</button>
          <button id="btnMood" class="btn btn-secondary">😎 Mood</button>
        </div>
      </div>

      <div class="messages-section">
        <div class="section-title"><span>📬</span><span id="messagesTitle">Fil des messages</span></div>
        <div id="messagesList" style="max-height:60vh;overflow:auto;padding-right:6px;"></div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;">
        <input id="messageInput" type="text" placeholder="Écris un message..." class="input-group" style="flex:1;padding:12px;border-radius:12px;" />
        <button id="sendBtn" class="btn btn-primary" style="width:110px;margin-left:6px;">Envoyer</button>
      </div>
    </div>

    <!-- bottom nav -->
    <div class="nav-bar">
      <button id="navHome" class="nav-btn active">🏠</button>
      <button id="navAdmin" class="nav-btn" style="display:none;">⚙️</button>
    </div>
  </div>

  <!-- MODALS -->

  <!-- Recorder Modal -->
  <div id="recModal" class="modal">
    <div class="modal-content">
      <h2>Enregistrement vocal</h2>
      <p id="recStatus">Prêt</p>
      <div style="display:flex;gap:8px;margin-top:12px;">
        <button id="startRecBtn" class="btn btn-primary">Démarrer</button>
        <button id="stopRecBtn" class="btn btn-secondary" disabled>Stop</button>
        <button id="closeRecBtn" class="btn btn-secondary">Fermer</button>
      </div>
      <div id="recPreview" style="margin-top:12px;"></div>
      <small style="color:rgba(255,255,255,0.6)">La voix est sauvegardée et partagée dans le chat.</small>
    </div>
  </div>

  <!-- Poll Modal -->
  <div id="pollModal" class="modal">
    <div class="modal-content">
      <h2>Créer un sondage</h2>
      <div class="input-group"><label>Question</label><input id="pollQuestion" /></div>
      <div class="input-group"><label>Option 1</label><input id="pollOpt1" placeholder="Oui" /></div>
      <div class="input-group"><label>Option 2</label><input id="pollOpt2" placeholder="Non" /></div>
      <div style="display:flex;gap:8px;">
        <button id="createPollBtn" class="btn btn-primary">Créer</button>
        <button id="closePollBtn" class="btn btn-secondary">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Challenge Modal -->
  <div id="challengeModal" class="modal">
    <div class="modal-content">
      <h2>Lancer un défi</h2>
      <div class="input-group"><label>Défi</label><input id="challengeText" placeholder="Ex: Envoie une photo drôle" /></div>
      <div style="display:flex;gap:8px;">
        <button id="createChallengeBtn" class="btn btn-primary">Lancer</button>
        <button id="closeChallengeBtn" class="btn btn-secondary">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <h2>Mon profil</h2>
      <div class="input-group"><label>Pseudo</label><input id="profileName" /></div>
      <div class="input-group"><label>Bio</label><input id="profileBio" /></div>
      <div class="input-group"><label>Emoji / humeur</label><input id="profileEmoji" placeholder="😎" /></div>
      <div style="display:flex;gap:8px;">
        <button id="saveProfileBtn" class="btn btn-primary">Sauvegarder</button>
        <button id="closeProfileBtn" class="btn btn-secondary">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Admin Password Modal -->
  <div id="adminPassModal" class="modal">
    <div class="modal-content">
      <h2>Mot de passe Admin</h2>
      <div class="input-group"><label>Mot de passe</label><input id="adminPassInput" type="password" /></div>
      <div style="display:flex;gap:8px;">
        <button id="adminPassSubmitBtn" class="btn btn-primary">Valider</button>
        <button id="adminPassCancelBtn" class="btn btn-secondary">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="modal">
    <div class="modal-content">
      <h2>Panel Admin</h2>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
        <button id="admBroadcastBtn" class="btn btn-primary">Broadcast message</button>
        <button id="admPushBtn" class="btn btn-secondary">Créer notif (écrit)</button>
        <button id="admExportUsersBtn" class="btn btn-secondary">Export users CSV</button>
        <button id="admExportTokensBtn" class="btn btn-secondary">Export FCM tokens</button>
        <button id="admClearMessagesBtn" class="btn btn-secondary">Vider messages</button>
        <button id="admSetPassBtn" class="btn btn-secondary">Init/Changer mot de passe</button>
      </div>

      <h3>Utilisateurs</h3>
      <div id="adminUsersList" style="max-height:200px;overflow:auto;"></div>

      <h3 style="margin-top:8px;">Messages</h3>
      <div id="adminMessagesList" style="max-height:200px;overflow:auto;"></div>

      <div style="display:flex;gap:8px;margin-top:10px;">
        <button id="closeAdminBtn" class="btn btn-secondary">Fermer</button>
      </div>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
